---

layout: post
title: 一种拟合身高曲线的方法
author: maiming
date: 2020-04-24
categories: analysis
tags: 统计学 生长发育曲线
description: 就算数据不光滑，也能提取出信息。
discuss_link: https://tieba.baidu.com/p/6640746646
enable_mathjax: true
license: 'cc-by-3.0-cn'
enable_comments: true

---

最近渤海在吧里发了青岛的历年身高数据，我们也再次确认了之前的想法——中国存在本地青年男性身高达到177，女性达到164厘米的城市。这里排除了大连，是因为尽管大连很早就出现了超过177/164厘米的调查，但是同期也存在与之相反的数据。

中国内部发展程度的差距很大。要揭示身高极限，全国数据不如分省数据，而分省数据不如单城市的城区数据。然而单城市的样本量较少，按照学生体质健康调研的要求，城市城区单性别，每个年龄段只需要50人作为样本。某些省市会按照200%准备，也就是100人样本。样本量并不算大，随机误差也不小。一个简单的例子：假设标准差为6厘米，样本量100人，平均身高为175.5厘米，那么我们对真实身高的估计是以95%的概率，真实身高落在[174.3, 176.7]的范围内，以99.7%的概率落在[173.7, 177.3]范围内。这就是这个数据能告诉我们的所有信息，真实的身高可能是176.4，也可能是174.5，不能再知道更多了。

下面是2010年北京市海淀区的学生体质调研中的男生数据，如果我们现在的任务是估计这批海淀学生的成年身高，要尽量准确，该怎么办？

<table>
  <caption>
    2010年北京市海淀区学生体质与健康调研身高
  </caption>
  <thead>
    <tr>
      <td>性别</td>
      <td>年龄</td>
      <td>人数</td>
      <td>平均身高/cm</td>
      <td>标准差/cm</td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td rowspan="12" style="text-align:center;">男</td>
      <td>7~</td>
      <td>69</td>
      <td>130.07</td>
      <td>4.86</td>
    </tr>
    <tr>
      <td>8~</td>
      <td>99</td>
      <td>134.42</td>
      <td>5.65</td>
    </tr>
    <tr>
      <td>9~</td>
      <td>87</td>
      <td>140.26</td>
      <td>5.20</td>
    </tr>
    <tr>
      <td>10~</td>
      <td>82</td>
      <td>146.37</td>
      <td>6.00</td>
    </tr>
    <tr>
      <td>11~</td>
      <td>88</td>
      <td>152.46</td>
      <td>8.29</td>
    </tr>
    <tr>
      <td>12~</td>
      <td>77</td>
      <td>160.21</td>
      <td>9.04</td>
    </tr>
    <tr>
      <td>13~</td>
      <td>91</td>
      <td>165.35</td>
      <td>8.74</td>
    </tr>
    <tr>
      <td>14~</td>
      <td>87</td>
      <td>173.39</td>
      <td>5.53</td>
    </tr>
    <tr>
      <td>15~</td>
      <td>93</td>
      <td>174.32</td>
      <td>5.94</td>
    </tr>
    <tr>
      <td>16~</td>
      <td>82</td>
      <td>175.19</td>
      <td>6.96</td>
    </tr>
    <tr>
      <td>17~</td>
      <td>87</td>
      <td>175.92</td>
      <td>6.09</td>
    </tr>
    <tr>
      <td>18</td>
      <td>62</td>
      <td>175.78</td>
      <td>5.55</td>
    </tr>
    <tr>
      <td rowspan="12" style="text-align:center;">女</td>
      <td>7~</td>
      <td>88</td>
      <td>128.30</td>
      <td>4.74</td>
    </tr>
    <tr>
      <td>8~</td>
      <td>93</td>
      <td>132.82</td>
      <td>5.61</td>
    </tr>
    <tr>
      <td>9~</td>
      <td>94</td>
      <td>139.41</td>
      <td>5.85</td>
    </tr>
    <tr>
      <td>10~</td>
      <td>81</td>
      <td>145.10</td>
      <td>6.43</td>
    </tr>
    <tr>
      <td>11~</td>
      <td>74</td>
      <td>152.46</td>
      <td>5.81</td>
    </tr>
    <tr>
      <td>12~</td>
      <td>69</td>
      <td>157.75</td>
      <td>6.20</td>
    </tr>
    <tr>
      <td>13~</td>
      <td>78</td>
      <td>161.19</td>
      <td>5.51</td>
    </tr>
    <tr>
      <td>14~</td>
      <td>74</td>
      <td>162.48</td>
      <td>6.09</td>
    </tr>
    <tr>
      <td>15~</td>
      <td>76</td>
      <td>162.70</td>
      <td>5.85</td>
    </tr>
    <tr>
      <td>16~</td>
      <td>86</td>
      <td>162.71</td>
      <td>5.03</td>
    </tr>
    <tr>
      <td>17~</td>
      <td>93</td>
      <td>161.57</td>
      <td>5.04</td>
    </tr>
    <tr>
      <td>18</td>
      <td>59</td>
      <td>163.22</td>
      <td>5.96</td>
    </tr>
  </tbody>
</table>

吧友们到现在总结出了下面几种办法：

1. 只取17岁（至于为什么是17岁，我在[前面的文章]({% post_url 2020-04-16-diaoyan-de-wenti %})中解释过了）。
2. 17～18岁求平均。这是渤海之前制作分省身高表格用的。
3. 综合考虑15～18岁数据。如果18岁数据异常则直接舍去，如果15、16岁数据高于17岁，则一起并入求平均。这对女生数据尤其有用，因为在发达地区的15～16岁，女生增长就很少了。勾魂眼用这个方法比较多。

第1种方法是无偏的，也就是说如果样本量够大，这个方法得到的身高会最准确，但是由于它「利用」到的数据最少，波动也最大。第2种办法利用了2倍的数据，波动因为减少为之前的0.71倍，更加稳定，但是由于18岁数据的种种问题，不是无偏的。第3种方法利用的数据量最大，波动应该是最小的，但是引入了太多主观因素（怎么定义异常？），可能会有内生的偏差。

## 一种整体的思路

我对这个问题的解决方法是不再单独估计某个年龄段的身高（比如说17岁），而是将7～18岁的数据作为一个整体，去估计7～18岁的生长发育曲线。这样我能使用到所有已知的数据，而不仅仅是15、16岁之后的。也就是说，假设我在一张纸上画出了所有的数据点，我要用一条曲线把他们连起来。

<figure>
  <img src="{{ site.baseurl }}/images/bjhd2010.svg" alt="北京市海淀区2010年7～18岁男生平均身高、95%置信区间"/>
  <figcaption>北京市海淀区2010年7～18岁男生平均身高、95%置信区间</figcaption>
</figure>

看起来数据不是很好，7～13岁均匀生长，然后在14岁有个凸增，再放缓，看起来不对。我们熟知的男生生长曲线，是这样的。

<figure>
  <img src="{{ site.baseurl }}/images/chn2005.svg" alt="中国2005年标准生长发育表男生中位数，4～18岁"/>
  <figcaption>中国2005年标准生长发育表男生中位数，4～18岁</figcaption>
</figure>

放在一起是这样的。

<figure>
  <img src="{{ site.baseurl }}/images/bjhd2010_chn2005.svg" alt="北京海淀2010和中国2005对比"/>
  <figcaption>北京海淀2010和中国2005对比</figcaption>
</figure>

看起来好了些，海淀2010比中国2005整体更高，这是自然的，左右方向可能也需要调整。如果适度地将蓝线平移，似乎就能得到比较好地结果。仅仅平移可能不够，毕竟如果整体身高更高，生长期增长的量也会更高，这时候就需要将曲线在上下方向上进行拉伸。对于生长发育周期更长的人群，我们也可能需要在左右方向进行拉伸。

这就是我的思路，将标准的生长发育图进行适当的平移、放缩，使之与身高数据尽可能接近，这时候我们就得到了拟合的生长曲线。

### 怎么衡量接近的程度

假设$f$是一个生长发育曲线，如果年龄是$a$，给出$a$岁时对应的中位或者平均身高为$f(a)$。假设我们的一共有$N$组身高数据，其中第$i$组，对应的年龄是$a_i$，平均身高是$h_i$，样本量是$N_i$，标准差是$\sigma_i$，$i=1,2,\ldots,n$。那么我们可以定义偏差度

\\[R(f) = \sum_{i=1}^n \frac{N_i(f(a_i) - h_i)^2}{\sigma_i^2}\\]

这是偏差度是在某种模型下似然度的负对数，在此就不详细多说了。我们在极小化这个偏差度$R$时，也在最大化某个模型的似然度。

### 怎么平移、放缩生长发育曲线

假设$f_0$是标准的生长发育曲线（比如中国2005），那么我们可以用下面的公式定义一族$f_0^{k_x, b_x, k_y, b_y}$：

\\[f_0^{k_x, b_x, k_y, b_y}(x) = k_y f_0 (k_x x + b_x) + b_y\\]

也就是说，给定生长发育曲线，我们的模型共有四个参数。我们改变这四个参数的值，使得$R$最小。

## 代码实现

根据上面的思路，我用Python实现了上述的拟合算法，并把代码放到了Github仓库[shengzhang-quxian-nihe](https://github.com/renleishengao/shengzhang-quxian-nihe)里。有一定计算机基础的话，在安装Python和相应包之后，就可以运行并且自己试验了。

### 海淀生长发育曲线

这就是运行代码得到的最佳拟合。如果相信这个拟合曲线的话，对应的18.0岁身高是176.1厘米。

<figure>
  <img src="{{ site.baseurl }}/images/bjhd2010_chn2005_fit.svg" alt="北京海淀2010测量数据与拟合曲线"/>
  <figcaption>北京海淀2010测量数据与拟合曲线</figcaption>
</figure>

这里舍弃了海淀18～19年龄段的数据，因为中国2005生长发育曲线只给到18.0岁的数据，再往后就没有了。